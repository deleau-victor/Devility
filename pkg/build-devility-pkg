#!/bin/bash
set -e

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
cd "$SCRIPT_DIR"

echo "üî® Build portforwardd (release)"
cd ../portforwardd
cargo build --release

echo "üìÅ Pr√©paration dossier pkg-root"
cd ../pkg
mkdir -p pkg-root/usr/local/bin
cp ../portforwardd/target/release/portforwardd pkg-root/usr/local/bin/

echo "üì¶ G√©n√©ration du .pkg"
pkgbuild \
  --root pkg-root \
  --scripts scripts \
  --identifier com.devility.portforwardd \
  --version 1.0.0 \
  --install-location / \
  devility-portforwardd.pkg

echo "‚úÖ .pkg g√©n√©r√© : devility-portforwardd.pkg"
